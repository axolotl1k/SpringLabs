<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title th:text="${lesson.subject} + ' – журнал'">Деталі заняття</title>
    <script>
        (function() {
            try {
                var savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                }
            } catch (e) {
            }
        })();
    </script>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body class="light">

<div class="container narrow">

    <a href="/" class="back-btn">Назад</a>

    <div class="card">

        <h1 th:text="${lesson.subject} + ': ' + (${#strings.isEmpty(lesson.topic)} ? 'Без теми' : ${lesson.topic})">
            Математика: Інтеграли</h1>

        <p class="meta">Дата:<span th:text="${#temporals.format(lesson.date, 'dd.MM.yyyy')}">16.11.2025</span></p>

        <div style="margin-bottom: 12px;">
            <a class="btn btn-primary" th:href="@{/teacher/lesson/{id}/add(id=${lesson.id})}">+ Додати відмітку</a>
        </div>

        <table>
            <thead>
            <tr>
                <th>Студент</th>
                <th>Статус</th>
                <th>Оцінка</th>
                <th>Остання зміна</th>
                <th style="width: 170px;">Дії</th>
            </tr>
            </thead>

            <tbody>

            <tr th:each="mark : ${lesson.marks}">

                <td data-label="Студент" th:text="${mark.studentName}">Іванов</td>

                <td data-label="Статус">
                    <span th:if="${mark.present}" class="status-present">Присутній</span>
                    <span th:unless="${mark.present}" class="status-absent">Відсутній</span>
                </td>

                <td data-label="Оцінка">

                    <div th:switch="${mark.grade}">

                        <span th:case="12" class="grade-pill grade-high"
                              th:text="${mark.grade} + ' (Відмінно)'"></span>

                        <span th:case="11" class="grade-pill grade-high"
                              th:text="${mark.grade} + ' (Відмінно)'"></span>

                        <span th:case="10" class="grade-pill grade-high"
                              th:text="${mark.grade} + ' (Відмінно)'"></span>

                        <span th:case="9" class="grade-pill grade-high"
                              th:text="${mark.grade} + ' (Дуже добре)'"></span>

                        <span th:case="8" class="grade-pill grade-high"
                              th:text="${mark.grade} + ' (Дуже добре)'"></span>

                        <span th:case="7" class="grade-pill grade-mid"
                              th:text="${mark.grade} + ' (Добре)'"></span>

                        <span th:case="6" class="grade-pill grade-mid"
                              th:text="${mark.grade} + ' (Добре)'"></span>

                        <span th:case="5" class="grade-pill grade-low"
                              th:text="${mark.grade} + ' (Задовільно)'"></span>

                        <span th:case="4" class="grade-pill grade-low"
                              th:text="${mark.grade} + ' (Задовільно)'"></span>

                        <span th:case="3" class="grade-pill grade-low"
                              th:text="${mark.grade} + ' (Незадовільно)'"></span>

                        <span th:case="2" class="grade-pill grade-low"
                              th:text="${mark.grade} + ' (Незадовільно)'"></span>

                        <span th:case="1" class="grade-pill grade-low"
                              th:text="${mark.grade} + ' (Незадовільно)'"></span>

                        <span th:case="*" class="grade-pill grade-none"
                              th:text="'Н/а'"></span>

                    </div>
                </td>

                <td data-label="Остання зміна"
                    th:text="${#temporals.format(mark.timestamp, 'dd.MM.yyyy HH:mm')}">01.01.2025 12:00</td>

                <td data-label="Дії">
                    <div class="actions">
                        <a class="btn btn-outline"
                           th:href="@{/teacher/lesson/{lessonId}/mark/{markId}/edit(lessonId=${lesson.id}, markId=${mark.id})}">
                            Редагувати</a>

                        <form th:action="@{/teacher/lesson/{lessonId}/mark/{markId}/delete(lessonId=${lesson.id}, markId=${mark.id})}"
                              method="post"
                              onsubmit="return confirm('Видалити відмітку?');">
                            <button class="btn btn-danger">Видалити</button>
                        </form>
                    </div>
                </td>

            </tr>

            <tr th:if="${#lists.isEmpty(lesson.marks)}">
                <td colspan="5" class="meta">Тут ще немає відміток. Додайте першу — натисніть
                    <strong>«Додати відмітку»</strong>.
                </td>
            </tr>

            </tbody>
        </table>
    </div>
</div>

<script th:src="@{/js/app.js}"></script>
</body>
</html>
